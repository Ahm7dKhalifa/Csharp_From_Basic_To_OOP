(function(b,a){$window=b(a);b.fn.lazyload=function(c){var e=this;var d={use_loading_mask:0,threshold:0,failure_limit:100,event:"scroll",effect:"show",container:a,data_attribute:"original",skip_invisible:true,appear:null,load:null};function f(){var g=0;e.each(function(){var h=b(this);if(d.skip_invisible&&!h.is(":visible")){return}if(b.abovethetop(this,d)||b.leftofbegin(this,d)){}else{if(!b.belowthefold(this,d)&&!b.rightoffold(this,d)){h.trigger("appear")}else{if(++g>d.failure_limit){return false}}}})}if(c){b.extend(d,c);if(d.effect_speed==0){d.effect_speed=undefined}}$container=(d.container===undefined||d.container===a)?$window:b(d.container);if(0===d.event.indexOf("scroll")){$container.bind(d.event,function(g){return f()})}this.each(function(){var i=this;var j=b(i);i.loaded=false;j.one("appear",function(){if(!this.loaded){if(d.appear){var l=e.length;d.appear.call(i,l,d)}var k=j.data(d.data_attribute);if(null==k){k=j.attr("data-"+d.data_attribute)}b("<img />").bind("load",function(){if(d.use_loading_mask){j.nextAll(".lazy_loading_mask").first().remove()}j.hide().attr("src",k)[d.effect](d.effect_speed).removeClass("lazy").removeAttr("data-"+d.data_attribute);i.loaded=true;var m=b.grep(e,function(o){return !o.loaded});e=b(m);if(d.load){var n=e.length;d.load.call(i,n,d)}}).attr("src",k)}});if(0!==d.event.indexOf("scroll")){j.bind(d.event,function(k){if(!i.loaded){j.trigger("appear")}})}if(d.use_loading_mask){if(!j.hasClass("no_lazy_mask")){var h=b("<div class='lazy_loading_mask'></div>");var g=j.innerHeight();if(undefined!=j.attr("height")){g=j.attr("height");if(!isNaN(g)){j.height(g)}}h.height(g);h.width(j.innerWidth());h.insertAfter(j);h.position({my:"center center",at:"center center",of:j})}}});$window.bind("resize",function(g){f()});f();return this};b.belowthefold=function(d,e){var c;if(e.container===undefined||e.container===a){c=$window.height()+$window.scrollTop()}else{c=$container.offset().top+$container.height()}return c<=b(d).offset().top-e.threshold};b.rightoffold=function(d,e){var c;if(e.container===undefined||e.container===a){c=$window.width()+$window.scrollLeft()}else{c=$container.offset().left+$container.width()}return c<=b(d).offset().left-e.threshold};b.abovethetop=function(d,e){var c;if(e.container===undefined||e.container===a){c=$window.scrollTop()}else{c=$container.offset().top}return c>=b(d).offset().top+e.threshold+b(d).height()};b.leftofbegin=function(d,e){var c;if(e.container===undefined||e.container===a){c=$window.scrollLeft()}else{c=$container.offset().left}return c>=b(d).offset().left+e.threshold+b(d).width()};b.inviewport=function(c,d){return !b.rightofscreen(c,d)&&!b.leftofscreen(c,d)&&!b.belowthefold(c,d)&&!b.abovethetop(c,d)}})(jQuery,window);